---
import Layout from "../../layouts/Layout.astro";
import { getLanguageFromCookie, createTranslator } from "../../lib/i18n/utils";

const lang = getLanguageFromCookie(Astro.request.headers.get("cookie"));
const t = createTranslator(lang);

// Call logout API to sign out user and clear session
try {
  const response = await fetch(`${Astro.url.origin}/api/auth/logout`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Cookie: Astro.request.headers.get("cookie") || "",
    },
  });

  if (!response.ok) {
    console.error("Logout API call failed:", response.status);
  }
} catch (error) {
  console.error("Error calling logout API:", error);
}
---

<Layout title={`${t("auth.logout")} - ${t("common.appName")}`} showNavigation={false}>
  <div class="flex min-h-screen items-center justify-center bg-background px-4">
    <div class="w-full max-w-md space-y-8 text-center">
      <div>
        <h1 class="text-3xl font-bold text-foreground">{t("auth.loggingOut")}</h1>
        <p class="mt-2 text-sm text-muted-foreground">{t("auth.logoutPrompt")}</p>
      </div>

      <!-- Success message -->
      <div class="rounded-lg border border-border bg-card p-8 shadow-sm">
        <div class="flex items-center justify-center">
          <div class="text-green-600">
            <svg class="h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  // Redirect to home after showing success message
  setTimeout(() => {
    window.location.href = "/";
  }, 1000);
</script>
